<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.ddit.board.dao.IBoardDAO">
	<sql id="searchFrag">
		<where>
			<if test="@org.apache.commons.lang3.StringUtils@isNotBlank(searchVO.searchWord)">
				<choose>
					<when test="'writer'.equals(searchVO.searchType)">
						INSTR(BO_WRITER, #{searchVO.searchWord}) > 0
					</when>
					<when test="'title'.equals(searchVO.searchType)">
						INSTR(BO_TITLE, #{searchVO.searchWord}) > 0
					</when>
					<otherwise>
						INSTR(BO_WRITER, #{searchVO.searchWord}) > 0
						OR INSTR(BO_TITLE, #{searchVO.searchWord}) > 0
					</otherwise>
				</choose>
			</if>
		</where>
	</sql>
	<select id="selectBoardCount" parameterType="PagingVO" resultType="int">
		SELECT COUNT(*)
		FROM   BOARD
		<include refid="searchFrag" />
	</select>
	
	<select id="selectBoardList" parameterType="PagingVO" resultType="BoardVO">
		WITH REPLYCNT AS
		(
		    SELECT BO_NO, COUNT(REP_NO) REP_CNT
		    FROM REPLY
		    GROUP BY BO_NO
		)
		SELECT B.*
		FROM (
			SELECT A.*, ROWNUM RNUM
			FROM (
				SELECT A.BO_NO    , BO_CONTENT, BO_TITLE  
				     , BO_WRITER, TO_CHAR(BO_DATE, 'YYYY-MM-DD HH:MI') BO_DATE
				     , BO_HIT, BO_REC, BO_IP     
					 , BO_MAIL  , BO_PARENT
					 , NVL(REP_CNT, 0) REP_CNT
				FROM BOARD A LEFT OUTER JOIN REPLYCNT B ON (A.BO_NO = B.BO_NO)
				<include refid="searchFrag" />				
				ORDER BY A.BO_NO DESC
			) A
		) B
		<![CDATA[
			WHERE RNUM BETWEEN #{startRow} AND #{endRow}
		]]>
	</select>




</mapper>